# tasks.py
from crewai import Task
from textwrap import dedent

class AnalysisTasks:
    def research(self, agent, company):
        return Task(
            description=dedent(
                f"""
                執行對{company}的深入市場研究，需要：
                
                1. 搜索和分析以下方面的信息：
                   - 公司最新財務表現和關鍵指標
                   - 重要商業新聞和公告
                   - 行業發展趨勢和競爭態勢
                   - 市場份額和競爭優勢
                   - 技術創新和研發進展
                   
                2. 特別關注：
                   - 最近的重大事件或公告
                   - 管理層變動或戰略調整
                   - 新產品或服務發布
                   - 重要合作或併購消息
                   - 市場評級和分析師觀點
                   
                3. 信息整理要求：
                   - 按重要性排序
                   - 包含具體數據和事實
                   - 標注信息來源
                   - 突出關鍵發現
                
                請確保信息的時效性和準確性。
                """
            ),
            async_execution=True,
            agent=agent,
            expected_output="""
                請提供一份結構完整的研究報告，包含：
                
                1. 公司概況
                   - 基本信息和業務概述
                   - 市場地位和競爭優勢
                   
                2. 最新動態（前5項最重要的新聞）
                   - 事件描述和影響分析
                   - 時間和來源信息
                   
                3. 財務表現
                   - 關鍵財務指標
                   - 同比環比分析
                   
                4. 行業分析
                   - 行業趨勢
                   - 競爭格局
                   
                5. 風險因素
                   - 潛在風險點
                   - 應對措施
                
                請用清晰的結構和專業的語言撰寫報告。
            """
        )
    
    def analysis(self, agent, context):
        return Task(
            description=dedent(
                f"""
                基於市場研究報告，進行深入的投資分析：
                
                1. 財務分析
                   - 分析核心財務指標
                   - 評估財務健康狀況
                   - 比較行業標準
                   
                2. 投資價值評估
                   - 公司競爭優勢
                   - 成長潛力分析
                   - 風險收益評估
                   
                3. 估值分析
                   - 使用多種估值方法
                   - 確定合理價值區間
                   - 與當前市價比較
                   
                4. 投資建議
                   - 明確的投資觀點
                   - 具體的操作建議
                   - 目標價位設定
                   
                請保持專業客觀，給出明確的投資建議。
                """
            ),
            agent=agent,
            context=[context],
            expected_output="""
                請提供一份專業的投資分析報告，包含：
                
                1. 投資總結
                   - 核心觀點
                   - 投資建議
                   
                2. 基本面分析
                   - 業務發展評估
                   - 競爭優勢分析
                   
                3. 財務分析
                   - 關鍵指標評估
                   - 財務健康狀況
                   
                4. 風險分析
                   - 主要風險因素
                   - 風險緩解建議
                   
                5. 投資建議
                   - 具體建議（買入/持有/賣出）
                   - 目標價位
                   - 投資時間範圍
                   - 注意事項
                
                請確保分析邏輯清晰，結論具體明確。
            """
        )